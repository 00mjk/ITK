# ITK Tcl package configuration.
#
# This file is moved by a CMake CONFIGURE_FILE command into a file in the
# build directory called "pkgIndex.tcl".
#
# If you edit this file, do not use the syntax "${var}" to refer to
# a Tcl variable, only to CMake variables.  CMake will replace any such
# construct with the value of the named CMake variable, or with the empty
# string if the names don't match.

namespace eval itk {
  #
  # This procedure will help configure other ITK Tcl packages.
  # Call it with:
  #   package = the name of the package
  #   version = the version number of the package
  #   subdir  = the subdirectory under Wrapping/Tcl where the
  #             package is built
  #
  proc ConfigureTclPackage {package version subdir} {
    set libPrefix "${ITK_LIBNAME_PREFIX}"
    set libPath [file join "${ITK_TCL_PACKAGE_DIR}" \
                           "${ITK_MSDEV_CONFIG_DIR}"]
    set libName $package
    set libExt [info sharedlibextension]
    set libFile [file join $libPath "$libPrefix$libName$libExt"]
    
    package ifneeded $package $version "
      if {\[catch { load \"$libFile\" } errorMessage \]} { puts \$errorMessage }
    "
  }
  
  # Procedure to drive configuration of all packages.
  proc ConfigureItkTclPackages {version} {
    # Configure ITK Tcl packages.
    ConfigureTclPackage VXLNumericsTcl     $version Numerics
    ConfigureTclPackage ITKNumericsTcl     $version Numerics
    ConfigureTclPackage ITKCommonTcl       $version Common
    ConfigureTclPackage ITKIOTcl           $version IO
    ConfigureTclPackage ITKBasicFiltersTcl $version BasicFilters
    ConfigureTclPackage ITKAlgorithmsTcl   $version Algorithms
    
    package ifneeded InsightToolkit $version "
      package require itknumerics $version
      package require itkcommon $version
      package require itkio $version
      package require itkbasicfilters $version
      package require itkalgorithms $version
      package require itkutils $version
      package provide InsightToolkit $version
    "

    package ifneeded itknumerics $version "
      package require VXLNumericsTcl $version
      package require ITKNumericsTcl $version
      package provide itknumerics $version
    "

    package ifneeded itkcommon $version "
      package require ITKCommonTcl $version
      package provide itkcommon $version
    "

    package ifneeded itkbasicfilters $version "
      package require ITKBasicFiltersTcl $version
      package provide itkbasicfilters $version
    "

    package ifneeded itkalgorithms $version "
      package require ITKAlgorithmsTcl $version
      package provide itkalgorithms $version
    "

    package ifneeded itkio $version "
      package require ITKIOTcl $version
      package provide itkio $version
    "

    package ifneeded itkutils $version "
      set src \[file join \"${ITK_TCL_SCRIPT_DIR}\" itkutils.tcl\]
      if {\[catch { source \"\$src\" } errorMessage \]} { puts \$errorMessage } \\
      else { package provide itkutils $version }
    "

    package ifneeded itkinteraction $version "
      set src \[file join \"${ITK_TCL_SCRIPT_DIR}\" itkinteraction.tcl\]
      if {\[catch { source \"\$src\" } errorMessage \]} { puts \$errorMessage } \\
      else { package provide itkinteraction $version }
    "

    package ifneeded itktesting $version "
      set src \[file join \"${ITK_TCL_SCRIPT_DIR}\" itktesting.tcl\]
      namespace eval itk::testing {
        set defaultDataRoot \"${ITK_TCL_DATA_ROOT}\"
        set defaultTestRoot \"${ITK_TCL_TEST_ROOT}\"
      }
      if {\[catch { source \"\$src\" } errorMessage \]} { puts \$errorMessage } \\
      else { package provide itktesting $version }
    "
  }
  
  # Make sure the procedure can be called.
  namespace export ConfigureItkTclPackages
}

# Configure packages with version 0.7.
itk::ConfigureItkTclPackages 0.7
